.. _pop:

Population analysis
===================

Methods
-------

At the heart of of any point charge embedding scheme is the assumption that the
electrostatic potential generated by an atom can be approximated at a certain
distance by that of a point charge:

.. math::

  \sum_{i} \frac{q_i}{|\mathbf{r_i} - \mathbf{r}|} \approx \sum_{i} \int \frac{|\Psi_i(\mathbf{r'})|^2}{|\mathbf{r'} - \mathbf{r}|} \mathbf{dr'}

With :math:`\Psi_i(\mathbf{r})` being the wavefunction of atom :math:`i`,
:math:`q_i` its point charge value and :math:`\mathbf{r_i}` its position.
This approximation naturally breaks down at small :math:`|\mathbf{r_i} - \mathbf{r}|`
but by including ground state exchange via the :term:`rl` term, this situation
is avoided.

The choice of :math:`q_i` is a non trivial matter. Considerable effort is spent
on parametrising forcefields for various applications, however in this case we
intend to use the point charges as one-electron terms in the :term:`mh` and
:term:`ml` Hamiltonians.

A first approximation can be the use of Mulliken charges. This has the
advantage of being trivial to compute in both the molecular and crystal
calculations. Unfortunately the well-known basis-set dependence of Mulliken
charge values can become a real problem.

Charge-density based methods represent the most direct way of fulfilling the
equation above. Hirshfeld and AIM charges\ :cite:`Henkelman2006` fall in this category. RESP
are practically defined by the equation, albeit in a radial range around the
atoms.

Crystal or molecular
--------------------

The population analysis methods described above can be applied to periodic
crystal calculations or single molecule calculations. Using the crystal
calculation has the advantage of including an interacting charge distribution at
equilibrium.

On the other hand, charges from molecular calculations could be more judicious
since they can be matched to the level of theory of the molecular calculation
that they are embedding. In this way if the high level of theory is TD-DFT B3LYP
and the low level of theory is DFT PBE, the charges assigned to :term:`mh` can
come from B3LYP and the ones to :term:`ml` from PBE. This is particularly
important in order to most totally cancel out intersystem electrostatic
interactions from :term:`rl`.
